# 테스트 플랜 (초안) — Hyperliquid + 1inch + Arbitrum

## 1) 왜 “테스트넷”만으로는 부족할 수 있나

- Hyperliquid는 Perp 실행이 “Arbitrum EVM 컨트랙트 호출”로 끝나지 않는 구조일 수 있어,
  우리가 원하는 “진짜 주문/포지션/펀딩” 통합 테스트가 **순수 EVM 테스트넷만으로는** 어려울 수 있습니다.
- 이 경우에도 개발을 막지 않기 위해, 아래처럼 **3단계 테스트 전략**으로 갑니다.

## 2) 3단계 테스트 전략(권장)

### 2.1 단위 테스트(현재 가능)
- 목표: Vault의 share 회계/출금요청 큐/권한/상태머신이 깨지지 않게 검증
- `forge test --offline`로 돌아가야 함

### 2.2 통합 테스트 A — 메인넷 포크(가장 현실적)
- 목표: Arbitrum One 상태를 포크해서
  - USDT(실제 컨트랙트)
  - 1inch router(실제 컨트랙트)
  - (가능한 범위에서) Hyperliquid 관련 온체인 구성요소가 있다면 그 주소
  - (대부분은) Hyperliquid API 호출을 모의(Mock)해서 Vault 로직을 통합 검증
  를 “실주소 그대로” 붙여서 테스트
- 장점: 테스트넷 배포 유무에 덜 의존, 실제 ABI/동작을 빠르게 검증 가능
- 단점: RPC 필요(네트워크 필요), 테스트가 느릴 수 있음

### 2.3 통합 테스트 B — 테스트넷(가능하면 추가)
- Hyperliquid가 테스트 환경(테스트넷/샌드박스)을 제공하는 경우에만 진행
- 목표: 소액으로 end-to-end를 직접 실행(배포→예치→진입→리밸→출금 배치)

## 3) 당장 우리가 할 것(우선순위)

1. **Vault(ERC4626 스타일) 구현 + 단위 테스트**
2. **Hyperliquid 연동 모델 확정** (`SPEC/HYPERLIQUID_INTEGRATION_CHECKLIST.md`)
3. 모델 확정되면 **포크 + Mock 통합 테스트**를 먼저 붙임
4. 테스트 환경이 제공되면 그때 E2E도 추가

## 4) 수수료(비용 모델) 테스트에 포함

- Perp 주문 비용은 Hyperliquid의 수수료/펀딩/정산 모델을 반영해,
  “예상 Funding 수익이 비용을 이기지 못하면 진입/조정하지 않는다”를 시나리오 테스트로 넣는다.

